<div class="w-full space-y-4">
  <div
    class="overflow-x-auto border rounded-lg p-4 bg-base-100 shadow space-y-4"
  >
    <div
      class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2"
    >
      <h2 class="text-lg sm:text-xl font-bold text-base-content">
        Egresos fijos
      </h2>
      <button
        class="btn btn-neutral btn-sm sm:btn-md w-full sm:w-auto"
        (click)="abrirModal()"
      >
        + Egreso
      </button>
    </div>

    <!-- Tabla -->
    <table class="table table-zebra w-full">
      <thead>
        <tr class="text-xs text-gray-500 uppercase">
          <th>#</th>
          <th>Concepto</th>
          <th>Valor</th>
          <th>Fecha</th>
          <th class="text-right">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let egreso of egresos; let i = index">
          <td>{{ i + 1 }}</td>
          <td>{{ egreso.detalle }}</td>
          <td>${{ egreso.valor }}</td>
          <td>{{ egreso.fecha_creacion | date : "shortDate" }}</td>
          <td class="text-right relative min-w-[80px] z-10">
            <div class="inline-block relative">
              <button
                class="btn btn-sm btn-ghost btn-circle"
                (click)="toggleDropdown($event, egreso, i)"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-5 w-5"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 6v.01M12 12v.01M12 18v.01"
                  />
                </svg>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Modal -->
<div
  class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"
  *ngIf="mostrarModal"
>
  <div class="bg-base-100 p-6 rounded-xl w-full max-w-md space-y-4 shadow-xl">
    <h2 class="text-lg font-bold text-base-content">
      {{ egresoSeleccionado ? "Editar egreso fijo" : "Nuevo egreso fijo" }}
    </h2>

    <!-- Concepto -->
    <div class="form-control w-full">
      <label class="label">
        <span class="label-text font-semibold">Concepto</span>
      </label>
      <input
        type="text"
        [(ngModel)]="nuevoEgreso.detalle"
        placeholder="Detalle"
        class="input input-bordered w-full"
      />
    </div>

    <!-- Costo -->
    <div class="form-control w-full">
      <label class="label">
        <span class="label-text font-semibold">Costo</span>
      </label>
      <input
        type="number"
        [(ngModel)]="nuevoEgreso.valor"
        placeholder="Costo $$"
        class="input input-bordered w-full"
      />
    </div>

    <div class="flex justify-end gap-2 pt-2">
      <button class="btn btn-outline btn-sm" (click)="mostrarModal = false">
        Cancelar
      </button>
      <button
        class="btn btn-primary btn-sm"
        [disabled]="cargando"
        (click)="guardarEgreso()"
      >
        {{ cargando ? "Guardando..." : "Guardar" }}
      </button>
    </div>
  </div>
</div>

<!-- MenÃº flotante contextual -->
<div
  *ngIf="dropdownAbierto"
  class="fixed z-[9999] w-40 bg-white border rounded shadow"
  [ngStyle]="{ top: dropdownPosY + 'px', left: dropdownPosX + 'px' }"
  (click)="$event.stopPropagation()"
>
  <button
    class="block w-full text-left px-4 py-2 hover:bg-gray-100"
    (click)="editarEgreso()"
  >
    Editar
  </button>
  <button
    class="block w-full text-left px-4 py-2 hover:bg-red-100 text-red-600"
    (click)="eliminarEgreso()"
  >
    Eliminar
  </button>
</div>
